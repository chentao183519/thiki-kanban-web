"use strict";var config={localhost:"http://localhost:8080"},kanbanApp=angular.module("kanbanApp",["ngRoute","boardController","entriesServices","ui.sortable","tasksServices","boardsService"]);kanbanApp.config(["$routeProvider",function(e){e.when("/entries",{templateUrl:"partials/boards.html",controller:"EntriesCtrl"}).when("/boards/:boardId/entries",{templateUrl:"partials/entries.html"}).when("/boards",{templateUrl:"partials/boards.html",controller:"boardController"}).otherwise({templateUrl:"partials/boards.html",controller:"boardController"})}]);var boardController=angular.module("boardController",[]),boardsLink="http://localhost:8080/boards";boardController.controller("boardController",["$scope","$location","$q","boardsService",function(e,r,t,n){var o=n.load(boardsLink);n.boardsLink=boardsLink,o.then(function(r){e.boards=r}),e.toEntries=function(e,t){r.path("/boards/"+e+"/entries").search({boardLink:t})},e.displayBoardCreationForm=!0,e.displayBoardCreationForm=!0,e.displayForm=!1,e.createBoard=function(){var r=e.board.name,t={name:r},o=n.create(t);o.then(function(r){null==e.boards&&(e.boards=[]),e.boards.push(r),e.board.name=""})},e.keyPress=function(r){13==r.keyCode&&e.createBoard(),27==r.keyCode&&e.cancelCreateTask()},e.showBoardCreationForm=function(){e.displayBoardCreationForm=!1,e.displayForm=!0},e.cancelCreateTask=function(){e.displayBoardCreationForm=!0,e.displayForm=!1}}]);var boardsService=angular.module("boardsService",["ngResource"]);boardsService.factory("boardsService",["$http","$q",function(e,r){return{boardsLink:"",load:function(t){var n=r.defer();return e({method:"GET",url:t}).success(function(e,r,t,o){n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise},loadBoardByLink:function(t){var n=r.defer();return e({method:"GET",url:t}).success(function(e,r,t,o){n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise},create:function(t){var n=r.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:this.boardsLink}).success(function(e,r,t,o){console.log(e),n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise}}}]);var entriesServices=angular.module("entriesServices",["ngResource"]);entriesServices.factory("entriesServices",["$http","$q",function(e,r){return{entriesLink:"",load:function(){console.log("========="+this.entriesLink);var t=r.defer();return e({method:"GET",dataType:"application/json",url:this.entriesLink}).success(function(e,r,n,o){console.log(e),t.resolve(e)}).error(function(e,r,n,o){t.reject(e)}),t.promise},create:function(t){var n=r.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:this.entriesLink}).success(function(e,r,t,o){console.log(e),n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise}}}]);var tasksServices=angular.module("tasksServices",["ngResource"]);tasksServices.factory("tasksServices",["$http","$q",function(e,r){return{loadTasksByEntryId:function(t){var n=r.defer(),o=[];return e({method:"GET",url:t}).success(function(e,r,t,a){o=e,n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise},create:function(t,n){var o=r.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:n}).success(function(e,r,t,n){console.log(e),o.resolve(e)}).error(function(e,r,t,n){o.reject(e)}),o.promise},update:function(t){var n=r.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:t._links.self.href}).success(function(e,r,t,o){console.log(e),n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("boardBanner",["$timeout",function(e){return{restrict:"E",templateUrl:"partials/board-banner.html",replace:!1,controller:["$scope","$routeParams","$location","boardsService",function(e,r,t,n){var o=r.boardLink,a=n.loadBoardByLink(o);a.then(function(r){e.board=r}),e.toBoards=function(){t.path("/boards")}}]}}]),kanbanApp.directive("repeatFinish",["$timeout",function(e){return{restrict:"A",link:function(r,t,n){1==r.$last&&e(function(){$(".entryTitle").editable(),r.$emit("ngRepeatFinished")})}}}]),kanbanApp.directive("entryCreation",["$timeout",function(e){return{restrict:"E",templateUrl:"partials/entry-creation.html",replace:!0,controller:["$scope","entriesServices",function(e,r){e.createEntry=function(){var t=e.entry.title,n={title:t,boardId:e.board.id},o=r.create(n);o.then(function(r){null==e.entries&&(e.entries=[]),e.entries.push(r),e.entry.title=""})},e.cancelCreateEntry=function(){$("#create-new-entry-form").hide(),$("#create-new-entry-button").show()},e.showCreateEntryForm=function(){$("#create-new-entry-button").hide(),$("#create-new-entry-form").show()},e.keyPress=function(r){13==r.keyCode&&e.createEntry(),27==r.keyCode&&e.cancelCreateEntry()}}]}}]),kanbanApp.directive("entries",["$timeout",function(e){return{restrict:"E",templateUrl:"partials/entry.html",replace:!0,controller:["$scope","$routeParams","boardsService","entriesServices","tasksServices",function(e,r,t,n,o){function a(){var i=r.boardLink,s=t.loadBoardByLink(i);s.then(function(r){e.board=r,n.entriesLink=r._links.entries.href;var t=n.load(r._links.entries.href);t.then(function(r){e.entries=r,e.sortableOptions={connectWith:".tasks",opacity:.5,start:function(e,r){},update:function(e,r){console.log(r.item.scope());var t=$(r.item.sortable.droptarget[0]).parent().attr("entryId");r.item.sortable.model.entryId=t,r.item.sortable.model.orderNumber=r.item.sortable.dropindex,console.log(r.item.sortable.model);var n=o.update(r.item.sortable.model);n.then(function(e){a()})},stop:function(e,r){}}})})}a()}]}}]),kanbanApp.directive("tasks",["$timeout",function(e){return{restrict:"E",templateUrl:"partials/tasks.html",replace:!0,controller:["$scope","tasksServices",function(e,r){var t=e.entry,n=r.loadTasksByEntryId(t._links.tasks.href);n.then(function(r){e.tasks=r})}]}}]),kanbanApp.directive("taskCreation",["$timeout",function(e){return{restrict:"E",templateUrl:"partials/task-creation.html",controller:["$scope","tasksServices",function(e,r){var t=e.entry;e.displayCreationButton=!0,e.displayForm=!1,e.showCreateTaskForm=function(){e.displayCreationButton=!1,e.displayForm=!0,e.summary=""},e.cancelCreateTask=function(){e.displayCreationButton=!0,e.displayForm=!1},e.createTask=function(){var n={summary:e.summary,entryId:t.id},o=r.create(n,t._links.tasks.href);o.then(function(n){var o=r.loadTasksByEntryId(t._links.tasks.href);o.then(function(r){e.tasks=r,e.displayCreationButton=!0,e.displayForm=!1})})},e.keyPress=function(r){13==r.keyCode&&e.createTask(),27==r.keyCode&&e.cancelCreateTask()}}]}}]);var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var r,t,n,o,a,i,s,c="",l=0;for(e=Base64._utf8_encode(e);l<e.length;)r=e.charCodeAt(l++),t=e.charCodeAt(l++),n=e.charCodeAt(l++),o=r>>2,a=(3&r)<<4|t>>4,i=(15&t)<<2|n>>6,s=63&n,isNaN(t)?i=s=64:isNaN(n)&&(s=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(i)+this._keyStr.charAt(s);return c},decode:function(e){var r,t,n,o,a,i,s,c="",l=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");l<e.length;)o=this._keyStr.indexOf(e.charAt(l++)),a=this._keyStr.indexOf(e.charAt(l++)),i=this._keyStr.indexOf(e.charAt(l++)),s=this._keyStr.indexOf(e.charAt(l++)),r=o<<2|a>>4,t=(15&a)<<4|i>>2,n=(3&i)<<6|s,c+=String.fromCharCode(r),64!=i&&(c+=String.fromCharCode(t)),64!=s&&(c+=String.fromCharCode(n));return c=Base64._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var r="",t=0;t<e.length;t++){var n=e.charCodeAt(t);128>n?r+=String.fromCharCode(n):n>127&&2048>n?(r+=String.fromCharCode(n>>6|192),r+=String.fromCharCode(63&n|128)):(r+=String.fromCharCode(n>>12|224),r+=String.fromCharCode(n>>6&63|128),r+=String.fromCharCode(63&n|128))}return r},_utf8_decode:function(e){for(var r="",t=0,n=c1=c2=0;t<e.length;)n=e.charCodeAt(t),128>n?(r+=String.fromCharCode(n),t++):n>191&&224>n?(c2=e.charCodeAt(t+1),r+=String.fromCharCode((31&n)<<6|63&c2),t+=2):(c2=e.charCodeAt(t+1),c3=e.charCodeAt(t+2),r+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),t+=3);return r}},HttpType={POST:"POST",PUT:"PUT",DELETE:"DELETE",GET:"GET"},Racoon={currentRequest:null,restful:function(e){var r=function(r){e.success(r)},t=function(r){e.success(r)},n=function(e,r){$("#errorMessage").html(e.responseJSON.message),$("#errorModel").modal()},o=function(e,r){$("#errorMessage").html(e.responseJSON.message),$("#errorModel").modal()};Racoon.currentRequest=$.ajax({type:e.type||HttpType.GET,url:e.url,dataType:e.dataType||"json",async:e.async||!0,data:e.data,contentType:"application/json",beforeSend:function(){void 0!=e.beforeSend?e.beforeSend():$("#processing").show()},statusCode:{200:r,201:t,400:n,404:o,500:n},complete:function(){$("#processing").hide()}})},getLink:function(e,r){return e[r].href},isFirefoxBrowser:function(){var e={},r=navigator.userAgent.toLowerCase(),t=/(msie|firefox|chrome|opera|version).*?([\d.]+)/,n=r.match(t);e.browser=n[1].replace(/version/,"'safari"),e.ver=n[2],"firefox"!=e.browser&&(window.location.href="html/pleaseSwitchYourBrowser.html")},JSONLength:function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},formatJson:function(e,r){var t=null,n="",o=0,a="    ";r=r||{},r.newlineAfterColonIfBeforeBraceOrBracket=r.newlineAfterColonIfBeforeBraceOrBracket===!0,r.spaceAfterColon=r.spaceAfterColon!==!1;try{"string"!=typeof e?e=JSON.stringify(e):(e=JSON.parse(e),e=JSON.stringify(e))}catch(i){return e}return t=/([\{\}])/g,e=e.replace(t,"\r\n$1\r\n"),t=/([\[\]])/g,e=e.replace(t,"\r\n$1\r\n"),t=/(\,)/g,e=e.replace(t,"$1\r\n"),t=/(\r\n\r\n)/g,e=e.replace(t,"\r\n"),t=/\r\n\,/g,e=e.replace(t,","),r.newlineAfterColonIfBeforeBraceOrBracket||(t=/\:\r\n\{/g,e=e.replace(t,":{"),t=/\:\r\n\[/g,e=e.replace(t,":[")),r.spaceAfterColon&&(t=/\:/g,e=e.replace(t,": ")),$.each(e.split("\r\n"),function(e,r){var t=0,i=0,s="";for(r.match(/\{$/)||r.match(/\[$/)?i=1:r.match(/\}/)||r.match(/\]/)?0!==o&&(o-=1):i=0,t=0;o>t;t++)s+=a;n+=s+r+"\r\n",o+=i}),n}};