var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,r,n,o,a,s,i,c="",l=0;for(e=Base64._utf8_encode(e);l<e.length;)t=e.charCodeAt(l++),r=e.charCodeAt(l++),n=e.charCodeAt(l++),o=t>>2,a=(3&t)<<4|r>>4,s=(15&r)<<2|n>>6,i=63&n,isNaN(r)?s=i=64:isNaN(n)&&(i=64),c=c+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(s)+this._keyStr.charAt(i);return c},decode:function(e){var t,r,n,o,a,s,i,c="",l=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");l<e.length;)o=this._keyStr.indexOf(e.charAt(l++)),a=this._keyStr.indexOf(e.charAt(l++)),s=this._keyStr.indexOf(e.charAt(l++)),i=this._keyStr.indexOf(e.charAt(l++)),t=o<<2|a>>4,r=(15&a)<<4|s>>2,n=(3&s)<<6|i,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(r)),64!=i&&(c+=String.fromCharCode(n));return c=Base64._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",r=0,n=c1=c2=0;r<e.length;)n=e.charCodeAt(r),128>n?(t+=String.fromCharCode(n),r++):n>191&&224>n?(c2=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&c2),r+=2):(c2=e.charCodeAt(r+1),c3=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),r+=3);return t}},config={localhost:"http://localhost:8080"},kanbanApp=angular.module("kanbanApp",["ngRoute","entriesControllers","entriesServices","ui.sortable","tasksServices"]);kanbanApp.config(["$routeProvider",function(e){e.when("/entries",{templateUrl:"partials/entries.html",controller:"EntriesCtrl"}).when("/tasks",{templateUrl:"partials/tasks.html",controller:"TasksCtrl"}).otherwise({templateUrl:"partials/entries.html",controller:"EntriesCtrl"})}]);var entriesControllers=angular.module("entriesControllers",[]);entriesControllers.controller("EntriesCtrl",["$scope","$q","Entries","Tasks",function(e,t,r,n){function o(){var o=[],a=r.load(),s=[];a.then(function(r){e.entries=r.entries,angular.forEach(e.entries,function(e){var t=n.loadTasksByEntryId(e.id);s.push(t)}),t.all(s).then(function(t){for(var r in t)o=o.concat(t[r]);e.tasks=o,e.sortableOptions={connectWith:".tasks",opacity:.5,start:function(e,t){},update:function(e,t){console.log("==========="+$(t.item.sortable.droptarget[0]).attr("entry"))},stop:function(e,t){console.log(t.item.scope());var r=JSON.parse($(t.item.sortable.droptarget[0]).attr("entry")).id;t.item.sortable.model.entryId=r,console.log(t.item.sortable.model)}}})})}o(),e.createEntry=function(){var t=e.entry.title,n={title:t},o=r.create(n);o.then(function(t){null==e.entries&&(e.entries=[]),e.entries.push(t),e.entry.title=""})},e.showCreateTaskForm=function(e){$("#task-create-button-"+e).hide(),$("#task-create-form-"+e).show()},e.cancelCreateTask=function(e){$("#task-create-form-"+e).hide(),$("#task-create-button-"+e).show()},e.cancelCreateEntry=function(){$("#create-new-entry-form").hide(),$("#create-new-entry-button").show()},e.showCreateEntryForm=function(){$("#create-new-entry-button").hide(),$("#create-new-entry-form").show()},e.encode=function(e){return Base64.encode(e)},e.createTask=function(e,t){var r=Base64.encode(e)+"-title",o=$("#"+r).val(),a={summary:o},s=n.create(a,t);s.then(function(e){})}}]);var entriesServices=angular.module("entriesServices",["ngResource"]);entriesServices.factory("Entries",["$http","$q",function(e,t){return{load:function(){var r=t.defer();return e({method:"GET",dataType:"application/json",url:config.localhost+"/entries"}).success(function(e,t,n,o){console.log(e),r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},create:function(r){var n=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:config.localhost+"/entries"}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("repeatFinish",["$timeout",function(e){return{restrict:"A",link:function(t,r,n){1==t.$last&&e(function(){$(".entryTitle").editable(),t.$emit("ngRepeatFinished")})}}}]);var tasksServices=angular.module("tasksServices",["ngResource"]);tasksServices.factory("Tasks",["$http","$q",function(e,t){return{loadTasksByEntryId:function(r){var n=t.defer(),o=[];return e({method:"GET",url:"mock/tasks/tasks-"+r+".json"}).success(function(e,t,r,a){o=e,n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},create:function(r,n){var o=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:n}).success(function(e,t,r,n){console.log(e),o.resolve(e)}).error(function(e,t,r,n){o.reject(e)}),o.promise}}}]);