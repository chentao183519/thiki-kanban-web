var config={localhost:"http://localhost:8080"},kanbanApp=angular.module("kanbanApp",["ngRoute","ngAnimate","ui.bootstrap","boardController","entriesServices","ui.sortable","tasksServices","boardsService","xeditable","LocalStorageModule"]);kanbanApp.config(["$routeProvider","$httpProvider","localStorageServiceProvider",function(e,t,r){r.setPrefix("thiki.kanban").setStorageType("sessionStorage"),t.interceptors.push("myHttpResponseInterceptor"),e.when("/boards/:boardId/entries",{templateUrl:"component/entry/partials/entry-partial.html"}).when("/boards",{templateUrl:"component/board/partials/boards.html",controller:"boardController"}).otherwise({templateUrl:"component/board/partials/boards.html",controller:"boardController"})}]),kanbanApp.run(["editableOptions",function(e){e.theme="bs3"}]),kanbanApp.factory("myHttpResponseInterceptor",["$q","$location",function(e,t){return{request:function(e){return e},requestError:function(t){return canRecover(t)?responseOrNewPromise:e.reject(t)},response:function(e){return e},responseError:function(t){return console.log(t),alert("请求出错"),canRecover(t)?responseOrNewPromise:e.reject(t)}}}]),angular.module("kanbanApp").controller("ModalInstanceCtrl",["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]),kanbanApp.directive("focus",["$timeout","$parse",function(e,t){return function(t,r,n){t.$watch(n.focus,function(t){e(function(){t&&r[0].focus()})},!0)}}]),angular.module("xeditable").factory("editableThemes",function(){var e={"default":{formTpl:'<form class="editable-wrap"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<span class="editable-controls"></span>',inputTpl:"",errorTpl:'<div class="editable-error" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit">save</button>',cancelTpl:'<button type="button" ng-click="$form.$cancel()">cancel</button>'},bs2:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls controls control-group" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary">好的</button>',cancelTpl:'<button type="button" class="btn" ng-click="$form.$cancel()"><span></span></button>'},bs3:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls form-group" ng-class="{\'has-error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary">好</button>',cancelTpl:'<button type="button" class="btn  editable-cancel-button" ng-click="$form.$cancel()">放弃</button>',buttonsClass:"",inputClass:"",postrender:function(){switch(this.directiveName){case"editableText":case"editableSelect":case"editableTextarea":case"editableEmail":case"editableTel":case"editableNumber":case"editableUrl":case"editableSearch":case"editableDate":case"editableDatetime":case"editableBsdate":case"editableTime":case"editableMonth":case"editableWeek":case"editablePassword":if(this.inputEl.addClass("form-control"),this.theme.inputClass){if(this.inputEl.attr("multiple")&&("input-sm"===this.theme.inputClass||"input-lg"===this.theme.inputClass))break;this.inputEl.addClass(this.theme.inputClass)}break;case"editableCheckbox":this.editorEl.addClass("checkbox")}this.buttonsEl&&this.theme.buttonsClass&&this.buttonsEl.find("button").addClass(this.theme.buttonsClass)}},semantic:{formTpl:'<form class="editable-wrap ui form" ng-class="{\'error\': $error}" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls ui fluid input" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error ui error message" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="mini ui buttons"></span>',submitTpl:'<button type="submit" class="ui primary button">好的</button>',cancelTpl:'<button type="button" class="ui button" ng-click="$form.$cancel()"><i class="ui cancel icon"></i></button>'}};return e}),kanbanApp.factory("assignmentServices",["$http","$q",function(e,t){return{assign:function(r,n){var o=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:n}).success(function(e,t,r,n){console.log(e),o.resolve(e)}).error(function(e,t,r,n){o.reject(e)}),o.promise}}}]);var boardController=angular.module("boardController",[]),boardsLink="http://localhost:8080/boards";boardController.controller("boardController",["$scope","$location","$q","boardsService","localStorageService",function(e,t,r,n,o){var a=n.load(boardsLink);n.boardsLink=boardsLink,a.then(function(t){e.boards=t}),e.toEntries=function(e,r){o.set("boardLink",r),t.path("/boards/"+e+"/entries")},e.displayBoardCreationForm=!0,e.displayForm=!1,e.createBoard=function(){var t=e.board.name,r={name:t},o=n.create(r);o.then(function(t){null===e.boards&&(e.boards=[]),e.boards.push(t),e.board.name=""})},e.keyPress=function(t){13==t.keyCode&&e.createBoard(),27==t.keyCode&&e.cancelCreateBoard()},e.showBoardCreationForm=function(){e.displayBoardCreationForm=!1,e.displayForm=!0},e.cancelCreateBoard=function(){e.displayBoardCreationForm=!0,e.displayForm=!1}}]),kanbanApp.directive("boardBanner",function(){return{restrict:"E",templateUrl:"component/board/partials/board-banner.html",replace:!1,controller:["$scope","$location","boardsService","localStorageService",function(e,t,r,n){var o=n.get("boardLink"),a=r.loadBoardByLink(o);a.then(function(t){e.board=t}),e.toBoards=function(){t.path("/boards")}}]}});var boardsService=angular.module("boardsService",["ngResource"]);boardsService.factory("boardsService",["$http","$q",function(e,t){return{boardsLink:"",load:function(r){var n=t.defer();return e({method:"GET",url:r}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},loadBoardByLink:function(r){var n=t.defer();return e({method:"GET",url:r}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},create:function(r){var n=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:this.boardsLink}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("entries",function(){return{restrict:"E",templateUrl:"component/entry/partials/entries.html",replace:!0,scope:!0,controller:["$scope","boardsService","entriesServices","localStorageService",function(e,t,r,n){e.loadEntries=function(){var o=n.get("boardLink"),a=t.loadBoardByLink(o);a.then(function(t){e.board=t,r.entriesLink=t._links.entries.href;var n=r.load(t._links.entries.href);n.then(function(t){e.entries=t})})},e.loadEntries()}]}}),kanbanApp.directive("entryCreation",function(){return{restrict:"E",templateUrl:"component/entry/partials/entry-creation.html",replace:!0,scope:!0,controller:["$scope","entriesServices",function(e,t){e.createEntry=function(){var r=e.title,n={title:r,boardId:e.board.id},o=t.create(n);o.then(function(t){null===e.entries&&(e.entries=[]),e.entries.push(t),e.title="",e.cancelCreateEntry()})},e.displayCreationButton=!0,e.displayForm=!1,e.cancelCreateEntry=function(){e.displayCreationButton=!0,e.displayForm=!1},e.showCreateEntryForm=function(){e.displayCreationButton=!1,e.displayForm=!0},e.keyPress=function(t){13==t.keyCode&&e.createEntry(),27==t.keyCode&&e.cancelCreateEntry()},e.blur=function(){""!==e.title&&void 0!==e.title||e.cancelCreateEntry()},e.updateEntry=function(e,r){var n=r;n.title=e;var o=t.update(n);o.then(function(){})}}]}}),kanbanApp.directive("entry",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/entry/partials/entry.html",replace:!0,transclude:!0,scope:{entry:"="},controller:["$scope","boardsService","entriesServices",function(t,r,n){t.displayEntryMenu=!1,t.onEntryMenuMouseOver=function(){t.displayEntryMenu=!0},t.onEntryMenuMouseLeave=function(){t.displayEntryMenu=!1};var o=t;t.openModal=function(t,r){e.open({animation:!1,templateUrl:"foundation/modal/partials/confirm-dialog.html",controller:["$scope","$uibModalInstance",function(e,a){e.title="警告",e.message="确定要删除"+t+"吗?",e.ok=function(){var e=n.deleteByLink(r);e.then(function(){o.$parent.loadEntries()}),a.close()},e.cancel=function(){a.dismiss("cancel")}}],size:"sm"})}}]}}]),angular.module("entriesServices",["ngResource"]).factory("entriesServices",["$http","$q",function(e,t){return{entriesLink:"",load:function(){var r=t.defer();return e({method:"GET",dataType:"application/json",url:this.entriesLink}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},create:function(r){var n=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:this.entriesLink}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},update:function(r){var n=t.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:r._links.self.href}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},deleteByLink:function(r){var n=t.defer();return e({method:"DELETE",contentType:"application/json",headers:{userId:"112"},url:r}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("taskCreation",["$timeout",function(e){return{restrict:"E",replace:!0,templateUrl:"component/task/partials/task-creation.html",controller:["$scope","tasksServices",function(e,t){var r=e.entry;e.displayCreationButton=!0,e.displayForm=!1,e.showCreateTaskForm=function(){e.displayCreationButton=!1,e.displayForm=!0,e.summary=""},e.cancelCreateTask=function(){e.displayCreationButton=!0,e.displayForm=!1},e.createTask=function(){var n={summary:e.summary,entryId:r.id},o=t.create(n,r._links.tasks.href);o.then(function(n){var o=t.loadTasksByEntryId(r._links.tasks.href);o.then(function(t){e.tasks=t,e.displayCreationButton=!0,e.displayForm=!1})})},e.keyPress=function(t){13==t.keyCode&&e.createTask(),27==t.keyCode&&e.cancelCreateTask()},e.blur=function(){""===e.summary&&(e.displayCreationButton=!0,e.displayForm=!1)}}]}}]),kanbanApp.directive("task",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/task/partials/task.html",replace:!0,transclude:!0,scope:{task:"="},controller:["$scope","localStorageService","assignmentServices","tasksServices",function(t,r,n,o){t.assign=function(t){r.set("userId","341182"),e.open({animation:!1,templateUrl:"component/task/partials/assignment-confirm.html",controller:["$scope","$uibModalInstance",function(e,o){e.title="确认信息",e.message="你确定要认领该任务吗?",e.ok=function(){var e={taskId:t.id,assignee:r.get("userId"),assigner:r.get("userId")};n.assign(e,t._links.assignments.href);o.close()},e.cancel=function(){o.dismiss("cancel")}}],size:"sm"})},t.updateTask=function(e,t){var r=t;r.summary=e;var n=o.update(r);n.then(function(){})},t.openDeleteModal=function(r,n){var a=t;e.open({animation:!1,templateUrl:"foundation/modal/partials/confirm-dialog.html",controller:["$scope","$uibModalInstance",function(e,t){e.title="警告",e.message="确定要删除"+r+"吗?",e.ok=function(){var e=o.deleteByLink(n);e.then(function(){a.$parent.loadTasks()}),t.close()},e.cancel=function(){t.dismiss("cancel")}}],size:"sm"})}}]}}]),kanbanApp.directive("tasks",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/task/partials/tasks.html",replace:!0,controller:["$scope","$routeParams","tasksServices","localStorageService","assignmentServices",function(e,t,r,n,o){e.loadTasks=function(){var t=e.entry,n=r.loadTasksByEntryId(t._links.tasks.href);n.then(function(t){e.tasks=t,e.sortableOptions={connectWith:".tasks",opacity:.5,placeholder:"task-drag-placeholder",start:function(e,t){console.log("staring sort.")},update:function(e,t){console.log("updating sort.")},stop:function(e,t){if(console.log("stopping sort."),void 0!==t.item.sortable.droptarget){var n=$(t.item.sortable.droptarget[0]).parent().attr("entryId");if(n!=t.item.sortable.model.entryId){t.item.sortable.model.entryId=n,t.item.sortable.model.orderNumber=t.item.sortable.dropindex;var o=r.update(t.item.sortable.model);o.then(function(e){})}}}}})},e.loadTasks()}]}}]);var tasksServices=angular.module("tasksServices",["ngResource"]);tasksServices.factory("tasksServices",["$http","$q",function(e,t){return{loadTasksByEntryId:function(r){var n=t.defer(),o=[];return e({method:"GET",url:r}).success(function(e,t,r,a){o=e,n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},create:function(r,n){var o=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:n}).success(function(e,t,r,n){console.log(e),o.resolve(e)}).error(function(e,t,r,n){o.reject(e)}),o.promise},update:function(r){var n=t.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:r._links.self.href}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},deleteByLink:function(r){var n=t.defer();return e({method:"DELETE",contentType:"application/json",headers:{userId:"112"},url:r}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]);