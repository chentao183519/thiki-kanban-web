"use strict";var config={localhost:"http://localhost:8080"},kanbanApp=angular.module("kanbanApp",["ngRoute","ngAnimate","ui.bootstrap","boardController","entriesServices","ui.sortable","tasksServices","boardsService","xeditable"]);kanbanApp.config(["$routeProvider",function(e){e.when("/boards/:boardId/entries",{templateUrl:"component/entry/partials/entry-partial.html"}).when("/boards",{templateUrl:"component/board/partials/boards.html",controller:"boardController"}).otherwise({templateUrl:"component/board/partials/boards.html",controller:"boardController"})}]),kanbanApp.run(["editableOptions",function(e){e.theme="bs3"}]);var boardController=angular.module("boardController",[]),boardsLink="http://localhost:8080/boards";boardController.controller("boardController",["$scope","$location","$q","boardsService",function(e,t,r,n){var o=n.load(boardsLink);n.boardsLink=boardsLink,o.then(function(t){e.boards=t}),e.toEntries=function(e,r){t.path("/boards/"+e+"/entries").search({boardLink:r})},e.displayBoardCreationForm=!0,e.displayForm=!1,e.createBoard=function(){var t=e.board.name,r={name:t},o=n.create(r);o.then(function(t){null==e.boards&&(e.boards=[]),e.boards.push(t),e.board.name=""})},e.keyPress=function(t){13==t.keyCode&&e.createBoard(),27==t.keyCode&&e.cancelCreateBoard()},e.showBoardCreationForm=function(){e.displayBoardCreationForm=!1,e.displayForm=!0},e.cancelCreateBoard=function(){e.displayBoardCreationForm=!0,e.displayForm=!1}}]),kanbanApp.directive("boardBanner",function(){return{restrict:"E",templateUrl:"component/board/partials/board-banner.html",replace:!1,controller:["$scope","$routeParams","$location","boardsService",function(e,t,r,n){var o=t.boardLink,a=n.loadBoardByLink(o);a.then(function(t){e.board=t}),e.toBoards=function(){r.path("/boards")}}]}});var boardsService=angular.module("boardsService",["ngResource"]);boardsService.factory("boardsService",["$http","$q",function(e,t){return{boardsLink:"",load:function(r){var n=t.defer();return e({method:"GET",url:r}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},loadBoardByLink:function(r){var n=t.defer();return e({method:"GET",url:r}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},create:function(r){var n=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:this.boardsLink}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("entryCreation",["$timeout",function(e){return{restrict:"E",templateUrl:"component/entry/partials/entry-creation.html",replace:!0,scope:!0,controller:["$scope","entriesServices",function(e,t){e.createEntry=function(){var r=e.entry.title,n={title:r,boardId:e.board.id},o=t.create(n);o.then(function(t){null==e.entries&&(e.entries=[]),e.entries.push(t),e.entry.title=""})},e.displayCreationButton=!0,e.displayForm=!1,e.cancelCreateEntry=function(){e.displayCreationButton=!0,e.displayForm=!1},e.showCreateEntryForm=function(){e.displayCreationButton=!1,e.displayForm=!0},e.keyPress=function(t){13==t.keyCode&&e.createEntry(),27==t.keyCode&&e.cancelCreateEntry()},e.updateEntry=function(e,r){var n=r;n.title=e;var o=t.update(n);o.then(function(){})}}]}}]),kanbanApp.directive("entries",function(){return{restrict:"E",templateUrl:"component/entry/partials/entries.html",replace:!0,scope:!0,controller:["$scope","$routeParams","boardsService","entriesServices","tasksServices",function(e,t,r,n,o){function a(){var a=t.boardLink,s=r.loadBoardByLink(a);s.then(function(a){e.board=a,n.entriesLink=a._links.entries.href;var s=n.load(a._links.entries.href);s.then(function(n){e.entries=n,e.sortableOptions={connectWith:".tasks",opacity:.5,start:function(e,t){},update:function(e,t){},stop:function(n,a){var s=$(a.item.sortable.droptarget[0]).parent().attr("entryId");a.item.sortable.model.entryId=s,a.item.sortable.model.orderNumber=a.item.sortable.dropindex;var i=o.update(a.item.sortable.model);i.then(function(n){var o=t.boardLink,a=r.loadBoardByLink(o);a.then(function(t){e.board=t})})}}})})}a()}]}}),kanbanApp.directive("entry",function(){return{restrict:"E",templateUrl:"component/entry/partials/entry.html",replace:!0,transclude:!0,scope:{entry:"="},controller:["$scope","$routeParams","boardsService","entriesServices","tasksServices",function(e,t,r,n,o){e.displayEntryMenu=!1,e.onEntryMenuMouseOver=function(){console.log(e),e.displayEntryMenu=!0},e.onEntryMenuMouseLeave=function(){e.displayEntryMenu=!1}}]}});var entriesServices=angular.module("entriesServices",["ngResource"]);entriesServices.factory("entriesServices",["$http","$q",function(e,t){return{entriesLink:"",load:function(){var r=t.defer();return e({method:"GET",dataType:"application/json",url:this.entriesLink}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},create:function(r){var n=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:this.entriesLink}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},update:function(r){var n=t.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:r._links.self.href}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("tasks",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/task/partials/tasks.html",replace:!0,controller:["$scope","tasksServices",function(t,r){function n(){var o=t.entry,a=r.loadTasksByEntryId(o._links.tasks.href);a.then(function(e){t.tasks=e}),t.open=function(t,o){e.open({animation:!1,templateUrl:"component/foundation/modal/partials/confirm-dialog.html",controller:["$scope","$uibModalInstance",function(e,a){e.title="警告",e.message="确定要删除"+t+"吗?",e.ok=function(){var e=r.deleteByLink(o);e.then(function(){n()}),a.close()},e.cancel=function(){a.dismiss("cancel")}}],size:"sm"})}}n(),t.updateTask=function(e,t){var n=t;n.summary=e;var o=r.update(n);o.then(function(){})}}]}}]),angular.module("kanbanApp").controller("ModalInstanceCtrl",["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]),kanbanApp.directive("taskCreation",["$timeout",function(e){return{restrict:"E",templateUrl:"component/task/partials/task-creation.html",controller:["$scope","tasksServices",function(e,t){var r=e.entry;e.displayCreationButton=!0,e.displayForm=!1,e.showCreateTaskForm=function(){e.displayCreationButton=!1,e.displayForm=!0,e.summary=""},e.cancelCreateTask=function(){e.displayCreationButton=!0,e.displayForm=!1},e.createTask=function(){var n={summary:e.summary,entryId:r.id},o=t.create(n,r._links.tasks.href);o.then(function(n){var o=t.loadTasksByEntryId(r._links.tasks.href);o.then(function(t){e.tasks=t,e.displayCreationButton=!0,e.displayForm=!1})})},e.keyPress=function(t){13==t.keyCode&&e.createTask(),27==t.keyCode&&e.cancelCreateTask()}}]}}]);var tasksServices=angular.module("tasksServices",["ngResource"]);tasksServices.factory("tasksServices",["$http","$q",function(e,t){return{loadTasksByEntryId:function(r){var n=t.defer(),o=[];return e({method:"GET",url:r}).success(function(e,t,r,a){o=e,n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},create:function(r,n){var o=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:n}).success(function(e,t,r,n){console.log(e),o.resolve(e)}).error(function(e,t,r,n){o.reject(e)}),o.promise},update:function(r){var n=t.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(r),headers:{userId:"112"},url:r._links.self.href}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},deleteByLink:function(r){var n=t.defer();return e({method:"DELETE",contentType:"application/json",headers:{userId:"112"},url:r}).success(function(e,t,r,o){console.log(e),n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("focus",["$timeout","$parse",function(e,t){return function(t,r,n){t.$watch(n.focus,function(t){e(function(){t&&r[0].focus()})},!0)}}]),angular.module("xeditable").factory("editableThemes",function(){var e={"default":{formTpl:'<form class="editable-wrap"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<span class="editable-controls"></span>',inputTpl:"",errorTpl:'<div class="editable-error" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit">save</button>',cancelTpl:'<button type="button" ng-click="$form.$cancel()">cancel</button>'},bs2:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls controls control-group" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary">好的</button>',cancelTpl:'<button type="button" class="btn" ng-click="$form.$cancel()"><span></span></button>'},bs3:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls form-group" ng-class="{\'has-error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary">好</button>',cancelTpl:'<button type="button" class="btn  editable-cancel-button" ng-click="$form.$cancel()">放弃</button>',buttonsClass:"",inputClass:"",postrender:function(){switch(this.directiveName){case"editableText":case"editableSelect":case"editableTextarea":case"editableEmail":case"editableTel":case"editableNumber":case"editableUrl":case"editableSearch":case"editableDate":case"editableDatetime":case"editableBsdate":case"editableTime":case"editableMonth":case"editableWeek":case"editablePassword":if(this.inputEl.addClass("form-control"),this.theme.inputClass){if(this.inputEl.attr("multiple")&&("input-sm"===this.theme.inputClass||"input-lg"===this.theme.inputClass))break;this.inputEl.addClass(this.theme.inputClass)}break;case"editableCheckbox":this.editorEl.addClass("checkbox")}this.buttonsEl&&this.theme.buttonsClass&&this.buttonsEl.find("button").addClass(this.theme.buttonsClass)}},semantic:{formTpl:'<form class="editable-wrap ui form" ng-class="{\'error\': $error}" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls ui fluid input" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error ui error message" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="mini ui buttons"></span>',submitTpl:'<button type="submit" class="ui primary button">好的</button>',cancelTpl:'<button type="button" class="ui button" ng-click="$form.$cancel()"><i class="ui cancel icon"></i></button>'}};return e});