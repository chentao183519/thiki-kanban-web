"use strict";var config={localhost:"http://localhost:8080"},kanbanApp=angular.module("kanbanApp",["ngRoute","boardController","entriesServices","ui.sortable","tasksServices","boardsService"]);kanbanApp.config(["$routeProvider",function(e){e.when("/entries",{templateUrl:"board/partials/boards.html",controller:"EntriesCtrl"}).when("/boards/:boardId/entries",{templateUrl:"entry/partials/entries.html"}).when("/boards",{templateUrl:"board/partials/boards.html",controller:"boardController"}).otherwise({templateUrl:"board/partials/boards.html",controller:"boardController"})}]);var boardController=angular.module("boardController",[]),boardsLink="http://localhost:8080/boards";boardController.controller("boardController",["$scope","$location","$q","boardsService",function(e,r,t,n){var o=n.load(boardsLink);n.boardsLink=boardsLink,o.then(function(r){e.boards=r}),e.toEntries=function(e,t){r.path("/boards/"+e+"/entries").search({boardLink:t})},e.displayBoardCreationForm=!0,e.displayBoardCreationForm=!0,e.displayForm=!1,e.createBoard=function(){var r=e.board.name,t={name:r},o=n.create(t);o.then(function(r){null==e.boards&&(e.boards=[]),e.boards.push(r),e.board.name=""})},e.keyPress=function(r){13==r.keyCode&&e.createBoard(),27==r.keyCode&&e.cancelCreateTask()},e.showBoardCreationForm=function(){e.displayBoardCreationForm=!1,e.displayForm=!0},e.cancelCreateTask=function(){e.displayBoardCreationForm=!0,e.displayForm=!1}}]),kanbanApp.directive("boardBanner",["$timeout",function(e){return{restrict:"E",templateUrl:"board/partials/board-banner.html",replace:!1,controller:["$scope","$routeParams","$location","boardsService",function(e,r,t,n){var o=r.boardLink,a=n.loadBoardByLink(o);a.then(function(r){e.board=r}),e.toBoards=function(){t.path("/boards")}}]}}]);var boardsService=angular.module("boardsService",["ngResource"]);boardsService.factory("boardsService",["$http","$q",function(e,r){return{boardsLink:"",load:function(t){var n=r.defer();return e({method:"GET",url:t}).success(function(e,r,t,o){n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise},loadBoardByLink:function(t){var n=r.defer();return e({method:"GET",url:t}).success(function(e,r,t,o){n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise},create:function(t){var n=r.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:this.boardsLink}).success(function(e,r,t,o){console.log(e),n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("repeatFinish",["$timeout",function(e){return{restrict:"A",link:function(r,t,n){1==r.$last&&e(function(){$(".entryTitle").editable(),r.$emit("ngRepeatFinished")})}}}]),kanbanApp.directive("entryCreation",["$timeout",function(e){return{restrict:"E",templateUrl:"entry/partials/entry-creation.html",replace:!0,controller:["$scope","entriesServices",function(e,r){e.createEntry=function(){var t=e.entry.title,n={title:t,boardId:e.board.id},o=r.create(n);o.then(function(r){null==e.entries&&(e.entries=[]),e.entries.push(r),e.entry.title=""})},e.cancelCreateEntry=function(){$("#create-new-entry-form").hide(),$("#create-new-entry-button").show()},e.showCreateEntryForm=function(){$("#create-new-entry-button").hide(),$("#create-new-entry-form").show()},e.keyPress=function(r){13==r.keyCode&&e.createEntry(),27==r.keyCode&&e.cancelCreateEntry()}}]}}]),kanbanApp.directive("entries",["$timeout",function(e){return{restrict:"E",templateUrl:"entry/partials/entry.html",replace:!0,controller:["$scope","$routeParams","boardsService","entriesServices","tasksServices",function(e,r,t,n,o){function a(){var s=r.boardLink,i=t.loadBoardByLink(s);i.then(function(r){e.board=r,n.entriesLink=r._links.entries.href;var t=n.load(r._links.entries.href);t.then(function(r){e.entries=r,e.sortableOptions={connectWith:".tasks",opacity:.5,start:function(e,r){},update:function(e,r){console.log(r.item.scope());var t=$(r.item.sortable.droptarget[0]).parent().attr("entryId");r.item.sortable.model.entryId=t,r.item.sortable.model.orderNumber=r.item.sortable.dropindex,console.log(r.item.sortable.model);var n=o.update(r.item.sortable.model);n.then(function(e){a()})},stop:function(e,r){}}})})}a()}]}}]);var entriesServices=angular.module("entriesServices",["ngResource"]);entriesServices.factory("entriesServices",["$http","$q",function(e,r){return{entriesLink:"",load:function(){console.log("========="+this.entriesLink);var t=r.defer();return e({method:"GET",dataType:"application/json",url:this.entriesLink}).success(function(e,r,n,o){console.log(e),t.resolve(e)}).error(function(e,r,n,o){t.reject(e)}),t.promise},create:function(t){var n=r.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:this.entriesLink}).success(function(e,r,t,o){console.log(e),n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise}}}]),kanbanApp.directive("tasks",["$timeout",function(e){return{restrict:"E",templateUrl:"task/partials/tasks.html",replace:!0,controller:["$scope","tasksServices",function(e,r){var t=e.entry,n=r.loadTasksByEntryId(t._links.tasks.href);n.then(function(r){e.tasks=r})}]}}]),kanbanApp.directive("taskCreation",["$timeout",function(e){return{restrict:"E",templateUrl:"task/partials/task-creation.html",controller:["$scope","tasksServices",function(e,r){var t=e.entry;e.displayCreationButton=!0,e.displayForm=!1,e.showCreateTaskForm=function(){e.displayCreationButton=!1,e.displayForm=!0,e.summary=""},e.cancelCreateTask=function(){e.displayCreationButton=!0,e.displayForm=!1},e.createTask=function(){var n={summary:e.summary,entryId:t.id},o=r.create(n,t._links.tasks.href);o.then(function(n){var o=r.loadTasksByEntryId(t._links.tasks.href);o.then(function(r){e.tasks=r,e.displayCreationButton=!0,e.displayForm=!1})})},e.keyPress=function(r){13==r.keyCode&&e.createTask(),27==r.keyCode&&e.cancelCreateTask()}}]}}]);var tasksServices=angular.module("tasksServices",["ngResource"]);tasksServices.factory("tasksServices",["$http","$q",function(e,r){return{loadTasksByEntryId:function(t){var n=r.defer(),o=[];return e({method:"GET",url:t}).success(function(e,r,t,a){o=e,n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise},create:function(t,n){var o=r.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:n}).success(function(e,r,t,n){console.log(e),o.resolve(e)}).error(function(e,r,t,n){o.reject(e)}),o.promise},update:function(t){var n=r.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(t),headers:{userId:"112"},url:t._links.self.href}).success(function(e,r,t,o){console.log(e),n.resolve(e)}).error(function(e,r,t,o){n.reject(e)}),n.promise}}}]);