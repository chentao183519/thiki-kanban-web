var config={localhost:"http://localhost:8080"},kanbanApp=angular.module("kanbanApp",["ngRoute","ngAnimate","ui.bootstrap","boardController","entriesServices","ui.sortable","tasksServices","boardsService","xeditable","LocalStorageModule"]);kanbanApp.config(["$routeProvider","$httpProvider","localStorageServiceProvider",function(e,t,n){n.setPrefix("thiki.kanban").setStorageType("sessionStorage"),t.interceptors.push("myHttpResponseInterceptor"),e.when("/boards/:boardId/entries",{templateUrl:"component/entry/partials/entry-partial.html"}).when("/boards",{templateUrl:"component/board/partials/boards.html",controller:"boardController"}).otherwise({templateUrl:"component/board/partials/boards.html",controller:"boardController"})}]),kanbanApp.run(["editableOptions",function(e){e.theme="bs3"}]),kanbanApp.factory("myHttpResponseInterceptor",["$q","$location",function(e,t){return{request:function(e){return e},requestError:function(t){return canRecover(t)?responseOrNewPromise:e.reject(t)},response:function(e){return e},responseError:function(t){return console.log(t),alert("请求出错"),canRecover(t)?responseOrNewPromise:e.reject(t)}}}]),angular.module("kanbanApp").controller("ModalInstanceCtrl",["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]),kanbanApp.directive("focus",["$timeout","$parse",function(e,t){return function(t,n,r){t.$watch(r.focus,function(t){e(function(){t&&n[0].focus()})},!0)}}]),angular.module("xeditable").factory("editableThemes",function(){var e={"default":{formTpl:'<form class="editable-wrap"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<span class="editable-controls"></span>',inputTpl:"",errorTpl:'<div class="editable-error" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit">save</button>',cancelTpl:'<button type="button" ng-click="$form.$cancel()">cancel</button>'},bs2:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls controls control-group" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary">好的</button>',cancelTpl:'<button type="button" class="btn" ng-click="$form.$cancel()"><span></span></button>'},bs3:{formTpl:'<form class="form-inline editable-wrap" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls form-group" ng-class="{\'has-error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error help-block" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="editable-buttons"></span>',submitTpl:'<button type="submit" class="btn btn-primary">好</button>',cancelTpl:'<button type="button" class="btn  editable-cancel-button" ng-click="$form.$cancel()">放弃</button>',buttonsClass:"",inputClass:"",postrender:function(){switch(this.directiveName){case"editableText":case"editableSelect":case"editableTextarea":case"editableEmail":case"editableTel":case"editableNumber":case"editableUrl":case"editableSearch":case"editableDate":case"editableDatetime":case"editableBsdate":case"editableTime":case"editableMonth":case"editableWeek":case"editablePassword":if(this.inputEl.addClass("form-control"),this.theme.inputClass){if(this.inputEl.attr("multiple")&&("input-sm"===this.theme.inputClass||"input-lg"===this.theme.inputClass))break;this.inputEl.addClass(this.theme.inputClass)}break;case"editableCheckbox":this.editorEl.addClass("checkbox")}this.buttonsEl&&this.theme.buttonsClass&&this.buttonsEl.find("button").addClass(this.theme.buttonsClass)}},semantic:{formTpl:'<form class="editable-wrap ui form" ng-class="{\'error\': $error}" role="form"></form>',noformTpl:'<span class="editable-wrap"></span>',controlsTpl:'<div class="editable-controls ui fluid input" ng-class="{\'error\': $error}"></div>',inputTpl:"",errorTpl:'<div class="editable-error ui error message" ng-show="$error" ng-bind="$error"></div>',buttonsTpl:'<span class="mini ui buttons"></span>',submitTpl:'<button type="submit" class="ui primary button">好的</button>',cancelTpl:'<button type="button" class="ui button" ng-click="$form.$cancel()"><i class="ui cancel icon"></i></button>'}};return e}),kanbanApp.directive("assignments",function(){return{restrict:"E",templateUrl:"component/assignment/partials/assignments.html",replace:!0,controller:["$scope","assignmentServices",function(e,t){e.loadAssignments=function(){var n=e,r=t.loadAssignments(e.task._links.assignments.href);r.then(function(t){e.assignments=t,n.isAssigned()})},e.loadAssignments()}]}}),kanbanApp.filter("assignmentUserNameFilter",function(){return function(e){return void 0!==e&&e.length>1?e.split("")[e.length-1]:e}}),kanbanApp.factory("assignmentServices",["$http","$q",function(e,t){return{assign:function(n,r){var o=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(n),headers:{userId:"112"},url:r}).success(function(e,t,n,r){o.resolve(e)}).error(function(e,t,n,r){o.reject(e)}),o.promise},loadAssignments:function(n){var r=t.defer();return e({method:"GET",url:n}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},giveUp:function(n){var r=t.defer();return e({method:"DELETE",contentType:"application/json",headers:{userId:"112"},url:n}).success(function(e,t,n,o){console.log(e),r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise}}}]);var boardController=angular.module("boardController",[]),boardsLink="http://localhost:8080/boards";boardController.controller("boardController",["$scope","$location","$q","boardsService","localStorageService",function(e,t,n,r,o){var s=r.load(boardsLink);r.boardsLink=boardsLink,s.then(function(t){e.boards=t}),e.toEntries=function(e,n){o.set("boardLink",n),t.path("/boards/"+e+"/entries")},e.displayBoardCreationForm=!0,e.displayForm=!1,e.createBoard=function(){var t=e.board.name,n={name:t},o=r.create(n);o.then(function(t){null===e.boards&&(e.boards=[]),e.boards.push(t),e.board.name=""})},e.keyPress=function(t){13==t.keyCode&&e.createBoard(),27==t.keyCode&&e.cancelCreateBoard()},e.showBoardCreationForm=function(){e.displayBoardCreationForm=!1,e.displayForm=!0},e.cancelCreateBoard=function(){e.displayBoardCreationForm=!0,e.displayForm=!1}}]),kanbanApp.directive("boardBanner",function(){return{restrict:"E",templateUrl:"component/board/partials/board-banner.html",replace:!0,controller:["$scope","$location","boardsService","localStorageService",function(e,t,n,r){var o=r.get("boardLink"),s=n.loadBoardByLink(o);s.then(function(t){e.board=t}),e.toBoards=function(){t.path("/boards")}}]}});var boardsService=angular.module("boardsService",["ngResource"]);boardsService.factory("boardsService",["$http","$q",function(e,t){return{boardsLink:"",load:function(n){var r=t.defer();return e({method:"GET",url:n}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},loadBoardByLink:function(n){var r=t.defer();return e({method:"GET",url:n}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},create:function(n){var r=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(n),headers:{userId:"112"},url:this.boardsLink}).success(function(e,t,n,o){console.log(e),r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise}}}]),kanbanApp.directive("entries",function(){return{restrict:"E",templateUrl:"component/entry/partials/entries.html",replace:!0,scope:!0,controller:["$scope","boardsService","entriesServices","localStorageService",function(e,t,n,r){e.loadEntries=function(){var o=r.get("boardLink"),s=t.loadBoardByLink(o);s.then(function(t){e.board=t,n.entriesLink=t._links.entries.href;var r=n.load(t._links.entries.href);r.then(function(t){e.entries=t})})},e.loadEntries()}]}}),kanbanApp.directive("entryCreation",function(){return{restrict:"E",templateUrl:"component/entry/partials/entry-creation.html",replace:!0,scope:!0,controller:["$scope","entriesServices",function(e,t){e.createEntry=function(){var n=e.title,r={title:n,boardId:e.board.id},o=t.create(r);o.then(function(t){null===e.entries&&(e.entries=[]),e.entries.push(t),e.title="",e.cancelCreateEntry()})},e.displayCreationButton=!0,e.displayForm=!1,e.cancelCreateEntry=function(){e.displayCreationButton=!0,e.displayForm=!1},e.showCreateEntryForm=function(){e.displayCreationButton=!1,e.displayForm=!0},e.keyPress=function(t){13==t.keyCode&&e.createEntry(),27==t.keyCode&&e.cancelCreateEntry()},e.blur=function(){""!==e.title&&void 0!==e.title||e.cancelCreateEntry()},e.updateEntry=function(e,n){var r=n;r.title=e;var o=t.update(r);o.then(function(){})}}]}}),kanbanApp.directive("entry",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/entry/partials/entry.html",replace:!0,transclude:!0,scope:{entry:"="},controller:["$scope","boardsService","entriesServices",function(t,n,r){t.displayEntryMenu=!1,t.onEntryMenuMouseOver=function(){t.displayEntryMenu=!0},t.onEntryMenuMouseLeave=function(){t.displayEntryMenu=!1};var o=t;t.openModal=function(t,n){e.open({animation:!1,templateUrl:"foundation/modal/partials/confirm-dialog.html",controller:["$scope","$uibModalInstance",function(e,s){e.title="警告",e.message="确定要删除"+t+"吗?",e.ok=function(){var e=r.deleteByLink(n);e.then(function(){o.$parent.loadEntries()}),s.close()},e.cancel=function(){s.dismiss("cancel")}}],size:"sm"})}}]}}]),angular.module("entriesServices",["ngResource"]).factory("entriesServices",["$http","$q",function(e,t){return{entriesLink:"",load:function(){var n=t.defer();return e({method:"GET",dataType:"application/json",url:this.entriesLink}).success(function(e,t,r,o){n.resolve(e)}).error(function(e,t,r,o){n.reject(e)}),n.promise},create:function(n){var r=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(n),headers:{userId:"112"},url:this.entriesLink}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},update:function(n){var r=t.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(n),headers:{userId:"112"},url:n._links.self.href}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},deleteByLink:function(n){var r=t.defer();return e({method:"DELETE",contentType:"application/json",headers:{userId:"112"},url:n}).success(function(e,t,n,o){r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise}}}]),kanbanApp.directive("taskCreation",["$timeout",function(e){return{restrict:"E",replace:!0,templateUrl:"component/task/partials/task-creation.html",controller:["$scope","tasksServices",function(e,t){var n=e.entry;e.displayCreationButton=!0,e.displayForm=!1,e.showCreateTaskForm=function(){e.displayCreationButton=!1,e.displayForm=!0,e.summary=""},e.cancelCreateTask=function(){e.displayCreationButton=!0,e.displayForm=!1},e.createTask=function(){var r={summary:e.summary,entryId:n.id},o=t.create(r,n._links.tasks.href);o.then(function(r){var o=t.loadTasksByEntryId(n._links.tasks.href);o.then(function(t){e.tasks=t,e.displayCreationButton=!0,e.displayForm=!1})})},e.keyPress=function(t){13==t.keyCode&&e.createTask(),27==t.keyCode&&e.cancelCreateTask()},e.blur=function(){""===e.summary&&(e.displayCreationButton=!0,e.displayForm=!1)}}]}}]),kanbanApp.directive("task",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/task/partials/task.html",replace:!0,transclude:!0,scope:{task:"="},controller:["$scope","localStorageService","assignmentServices","tasksServices",function(t,n,r,o){t.assign=function(o){n.set("userId","341182");var s=t;e.open({animation:!1,templateUrl:"component/task/partials/assignment-confirm.html",controller:["$scope","$uibModalInstance",function(e,t){e.title="确认信息",s.isIamAssigned?(e.message="你确定不再做该任务吗?",e.ok=function(){var e,o=n.get("userId");angular.forEach(s.assignments,function(t){return o===t.assignee?void(e=t._links.self.href):void 0});var a=r.giveUp(e);a.then(function(e){s.loadAssignments()}),t.close()}):(e.message="你确定要认领该任务吗?",e.ok=function(){var e={taskId:o.id,assignee:n.get("userId"),assigner:n.get("userId")},a=r.assign(e,o._links.assignments.href);a.then(function(e){s.loadAssignments()}),t.close()}),e.cancel=function(){t.dismiss("cancel")}}],size:"sm"})},t.updateTask=function(e,t){var n=t;n.summary=e;var r=o.update(n);r.then(function(){})},t.openDeleteModal=function(n,r){var s=t;e.open({animation:!1,templateUrl:"foundation/modal/partials/confirm-dialog.html",controller:["$scope","$uibModalInstance",function(e,t){e.title="警告",e.message="确定要删除"+n+"吗?",e.ok=function(){var e=o.deleteByLink(r);e.then(function(){s.$parent.loadTasks()}),t.close()},e.cancel=function(){t.dismiss("cancel")}}],size:"sm"})},t.isAssigned=function(){var e=n.get("userId");t.isIamAssigned=!1,angular.forEach(t.assignments,function(n){return e===n.assignee?void(t.isIamAssigned=!0):void 0}),t.assignTip=t.isIamAssigned===!0?"我不做了":"认领"}}]}}]),kanbanApp.directive("tasks",["$uibModal",function(e){return{restrict:"E",templateUrl:"component/task/partials/tasks.html",replace:!0,controller:["$scope","$routeParams","tasksServices","localStorageService","assignmentServices",function(e,t,n,r,o){e.loadTasks=function(){var t=e.entry,r=n.loadTasksByEntryId(t._links.tasks.href);r.then(function(t){e.tasks=t,e.sortableOptions={connectWith:".tasks",opacity:.5,placeholder:"task-drag-placeholder",start:function(e,t){console.log("staring sort.")},update:function(e,t){console.log("updating sort.")},stop:function(e,t){if(console.log("stopping sort."),void 0!==t.item.sortable.droptarget){var r=$(t.item.sortable.droptarget[0]).parent().attr("entryId");if(r!=t.item.sortable.model.entryId){t.item.sortable.model.entryId=r,t.item.sortable.model.orderNumber=t.item.sortable.dropindex;var o=n.update(t.item.sortable.model);o.then(function(e){})}}}}})},e.loadTasks()}]}}]);var tasksServices=angular.module("tasksServices",["ngResource"]);tasksServices.factory("tasksServices",["$http","$q",function(e,t){return{loadTasksByEntryId:function(n){var r=t.defer(),o=[];return e({method:"GET",url:n}).success(function(e,t,n,s){o=e,r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},create:function(n,r){var o=t.defer();return e({method:"POST",contentType:"application/json",data:JSON.stringify(n),headers:{userId:"112"},url:r}).success(function(e,t,n,r){console.log(e),o.resolve(e)}).error(function(e,t,n,r){o.reject(e)}),o.promise},update:function(n){var r=t.defer();return e({method:"PUT",contentType:"application/json",data:JSON.stringify(n),headers:{userId:"112"},url:n._links.self.href}).success(function(e,t,n,o){console.log(e),r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise},deleteByLink:function(n){var r=t.defer();return e({method:"DELETE",contentType:"application/json",headers:{userId:"112"},url:n}).success(function(e,t,n,o){console.log(e),r.resolve(e)}).error(function(e,t,n,o){r.reject(e)}),r.promise}}}]);